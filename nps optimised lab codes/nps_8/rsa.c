#include<stdio.h>
#include<math.h>
#include<string.h>

int gcd(int a, int b)
{
    if(b == 0)
        return a;
    
    return gcd(b, a%b);
}

int encrypt(char ch, int e, int n)
{
    int temp = ch;

    for(int i = 1; i < e; i++)
        temp = (temp * ch) % n;
    
    return temp;
}

char decrypt(int ch, int d, int n)
{
    int temp = ch;

    for(int i = 1; i < d; i++)
        temp = (temp * ch) % n;
    
    return temp;
}

int main()
{
    //------------------------------------------------------------------------------------------------
    //  > Take the value of two prime numbers
    //------------------------------------------------------------------------------------------------
        int p;
        int q;

        printf("Enter the value of prime numbers p and q : ");
        scanf("%d", &p);
        scanf("%d", &q);
    //------------------------------------------------------------------------------------------------
    //  > Find the value of n
    //------------------------------------------------------------------------------------------------
        int n = p*q;
    //------------------------------------------------------------------------------------------------
    //  > Find the value of phi
    //------------------------------------------------------------------------------------------------
        int phi = (p-1)*(q-1);
    //------------------------------------------------------------------------------------------------
    //  > Find the value of e
    //------------------------------------------------------------------------------------------------
        int e = 1;

        while(gcd(phi, e) != 1 || e <= 1) {
            e = rand()%phi;
        }
    //------------------------------------------------------------------------------------------------
    //  > Find the value of d
    //------------------------------------------------------------------------------------------------
        int d = 1;

        while((d*e) % phi != 1) {
            d = rand() % phi;
        }
    //------------------------------------------------------------------------------------------------
    //  > Public and Private key:
    //------------------------------------------------------------------------------------------------
        printf("Public key  = {%d, %d}\n", e, n);
        printf("Private key = {%d, %d}\n", d, n);
    //------------------------------------------------------------------------------------------------
    //  > Enter the plain text:
    //------------------------------------------------------------------------------------------------
        char plain[1024];

        printf("Enter the value of plain text : ");
        scanf("%s", plain);
    //------------------------------------------------------------------------------------------------
    //  > Encryption:
    //------------------------------------------------------------------------------------------------
        int cipher[1024];


        for(int i = 0; i < strlen(plain); i++)
            cipher[i] = encrypt(plain[i], e, n);

        printf("Encrypted text : ");
        for(int i = 0; i < strlen(plain); i++)
            printf("%d", cipher[i]);
        printf("\n");
    //------------------------------------------------------------------------------------------------
    //  > Decryption
    //------------------------------------------------------------------------------------------------
        for(int i = 0; i < strlen(plain); i++)
            plain[i] = decrypt(cipher[i], d, n);

        printf("Decrypted text : ");
        for(int i = 0; i < strlen(plain); i++)
            printf("%c", plain[i]);
        printf("\n");

    //------------------------------------------------------------------------------------------------






}